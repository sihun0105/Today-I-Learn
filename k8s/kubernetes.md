## 쿠버네티스

쿠버네티스란 컨테이너 오케스트레이션 도구의 일정이다.

컨테이너 오케스트레이션이란 시스템 전체를 통괄하고 여러 개의 컨테이너를 관리하는 일을 말한다.
그 이름 그대로 오케스트라를 떠올리면 이해가 쉽다. 지휘자가 전체 악단을 지휘하듯, 여러 개의 컨테이너를 지휘하는 도구가 바로 쿠버네티스다.

### 클러스터의 구성 - 마스터 노드와 워커 노드

쿠버네티스는 전체적인 제어를 담당하는 `마스터노드`,실제 동작을 담당하는 `워커노드` 두가지 유형의 노드로 구성된다.

마스터 노드에서는 컨테이너를 실행하지는 않으며 워커 노드에서 실행되는 컨테이너를 관리하는 역할을 한다.
워커노드는 실제 서버에 해당하는 붑누으로, 컨테이너가 실제 동자가흔 서버다. 컨테이너가 동작해야 하므로 컨테이너 엔진이 설치되어 있어야 한다.

이렇게 마스터 노드와 워커 노드로 구성된 일군의 쿠버네티스 시스템을 클러스터라고 한다.

#### 마스터 노드측 컨트롤 플레인 구성

| 항목                     | 내용                                                              |
| ------------------------ | ----------------------------------------------------------------- |
| kube-apiserver           | 외부와 통신하는 프로세스, kubectl로부터 명령얼 전달받아 실행한다. |
| kube-controller-manager  | 컨트롤러를 통합 관리, 실행한다.                                   |
| kube-scheduler           | 파드를 워커 노드에 할당한다.                                      |
| cloud-controller-manager | 클라우드 서비스와 연동해 서비스를 생성한다.                       |
| etcd                     | 클러스터 관련 정보 전반을 관리하는 데이터베이스                   |

#### 워커 노드측 구성

| 항목       | 내용                                                                                                                                                             |
| ---------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| kube-let   | 마스터 노드에 있는 kube-scheduler와 연동하며 워커 노드에 파드를 배치하고 실행한다. 또 실행 중인 파드의 상태를 정기적으로 모니터링하며 kube-scheduler에 통지한다. |
| kube-proxy | 네트워크 통신의 라우팅 메커니즘                                                                                                                                  |

#### 디플로이먼트

파드의 배포를 관리하는 요소로, 파드가 사용하는 이미지 등 파드에 대한 정보를 갖고 있다.

#### 레플리카세트

파드의 수를 관리한다.

### 주요 커맨드

| 커맨드       | 내용                                                      |
| ------------ | --------------------------------------------------------- |
| create       | 리소스를 생성                                             |
| edit         | 리소스를 편집                                             |
| delete       | 리소스를 삭제                                             |
| get          | 리소스의 상태를 출력                                      |
| set          | 리소스의 값을 설정                                        |
| apply        | 리소스의 변경 사항을 반영                                 |
| describe     | 상태 정보를 확인                                          |
| diff         | 바람직한 상태와 현재 상태의 차이를 확인                   |
| expose       | 여러 파드에 부하를 분산하는 새로운 서비스 오브젝트를 생성 |
| scale        | 레플리카 수를 변경                                        |
| autoscale    | 자동 스케일링을 적용                                      |
| rollout      | 롤아웃을 수행                                             |
| exec         | 컨테이너에서 명령을 실행                                  |
| run          | 컨테이너에서 명령을 한번 실행                             |
| attach       | 컨테이너에 접속                                           |
| cp           | 컨테이너에 파일을 복사                                    |
| logs         | 컨테이너의 로그를 화면에 출력                             |
| cluster-info | 클러스터의 상세 정보를 화면에 출력                        |
| top          | CPU,메모리,스토리지 등 시스템 자원을 확인                 |


#### 커맨드 예시
kubectl scale deployment [디플로이먼트 이름] --replicas=[수정할 replica 수]
